"use strict";(self.webpackChunkbrooder=self.webpackChunkbrooder||[]).push([[9069],{4050:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"workflows/auth/registration","title":"Registration","description":"This workflow covers the registration process for both Customers and Providers.","source":"@site/docs/workflows/auth/registration.md","sourceDirName":"workflows/auth","slug":"/workflows/auth/registration","permalink":"/brooder-doc/docs/workflows/auth/registration","draft":false,"unlisted":false,"editUrl":"https://github.com/khalidgxg/brooder/tree/main/docs/workflows/auth/registration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","next":{"title":"Login and Activation","permalink":"/brooder-doc/docs/workflows/auth/login-and-activation"}}');var n=i(4848),t=i(8453);const d={},c="Registration",l={},a=[{value:"Flow Diagram",id:"flow-diagram",level:2},{value:"1. Customer Registration",id:"1-customer-registration",level:2},{value:"Request Body",id:"request-body",level:3},{value:"Success Response",id:"success-response",level:3},{value:"Code Highlights &amp; Key Concepts",id:"code-highlights--key-concepts",level:3},{value:"2. Provider Registration",id:"2-provider-registration",level:2},{value:"Request Body",id:"request-body-1",level:3},{value:"Success Response",id:"success-response-1",level:3},{value:"Code Highlights &amp; Key Concepts",id:"code-highlights--key-concepts-1",level:3}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"registration",children:"Registration"})}),"\n",(0,n.jsx)(s.p,{children:"This workflow covers the registration process for both Customers and Providers."}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"flow-diagram",children:"Flow Diagram"}),"\n",(0,n.jsx)(s.mermaid,{value:'graph TD;\r\n    subgraph "Registration Flow"\r\n        A["User submits registration form (Customer or Provider)"] --\x3e B["POST /api/v1/register/..."];\r\n        B --\x3e C{"Backend validates submitted data"};\r\n        C -- Valid --\x3e D["Create new user record (inactive)"];\r\n        D --\x3e E["Generate 4-digit OTP"];\r\n        E --\x3e F["Send OTP to user\'s email"];\r\n        F --\x3e G["Return success message with OTP expiry time end_at"];\r\n        C -- Invalid --\x3e H["Return validation errors"];\r\n    end'}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"1-customer-registration",children:"1. Customer Registration"}),"\n",(0,n.jsx)(s.p,{children:"This endpoint allows a new user to register as a Customer."}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Endpoint:"})," ",(0,n.jsx)(s.code,{children:"POST /api/v1/register/customer"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Method:"})," ",(0,n.jsx)(s.code,{children:"POST"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Authentication:"})," Not required"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"request-body",children:"Request Body"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Parameter"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Rules"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"first_name"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Must contain only letters (Arabic/English) and spaces. Min 2, max 50 characters."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_name"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Must contain only letters (Arabic/English) and spaces. Min 2, max 50 characters."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"email"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be a valid email format and unique in the ",(0,n.jsx)(s.code,{children:"users"})," table."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"password"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be at least 8 characters long and contain letters, mixed case, numbers, and symbols. Must be sent with a matching ",(0,n.jsx)(s.code,{children:"password_confirmation"})," field."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"phone"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be a unique phone number in the ",(0,n.jsx)(s.code,{children:"users"})," table. Must contain only digits, between 8 and 15 digits long."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"phone_country"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:'Required. Must be a valid country code (e.g., "SA", "US").'})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"gender"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be one of the allowed gender values (e.g., ",(0,n.jsx)(s.code,{children:"male"}),", ",(0,n.jsx)(s.code,{children:"female"}),")."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"city_id"})}),(0,n.jsx)(s.td,{children:"integer"}),(0,n.jsxs)(s.td,{children:["Required. Must be a valid ID of a city from the ",(0,n.jsx)(s.code,{children:"cities"})," table."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"nationality_id"})}),(0,n.jsx)(s.td,{children:"integer"}),(0,n.jsxs)(s.td,{children:["Required. Must be a valid ID of a nationality from the ",(0,n.jsx)(s.code,{children:"nationalities"})," table."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"avatar"})}),(0,n.jsx)(s.td,{children:"file"}),(0,n.jsx)(s.td,{children:"Optional. Must be an image file (e.g., png, jpg) with a maximum size of 2MB."})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"success-response",children:"Success Response"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Code:"})," ",(0,n.jsx)(s.code,{children:"200 OK"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Content:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\r\n    "message": "Data created successfully.",\r\n    "data": {\r\n        "end_at": "2024-08-01T12:00:00.000000Z"\r\n    }\r\n}\n'})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"end_at"}),": The timestamp indicating when the OTP for account activation will expire."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"code-highlights--key-concepts",children:"Code Highlights & Key Concepts"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Database Transactions"}),": The entire registration process is wrapped in a ",(0,n.jsx)(s.code,{children:"DB::transaction()"}),". This ensures that if any step fails (e.g., saving the user, creating the profile, or uploading a file), the entire operation is rolled back, preventing incomplete or corrupt user data in the database."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Inactive User Creation"}),": A new ",(0,n.jsx)(s.code,{children:"User"})," is created with a ",(0,n.jsx)(s.code,{children:"null"})," value for the ",(0,n.jsx)(s.code,{children:"email_verified_at"})," column. This is a crucial security step that marks the account as inactive and prevents login until the email is verified via OTP."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Polymorphic Profile"}),": The system creates a generic ",(0,n.jsx)(s.code,{children:"Profile"})," record associated with the ",(0,n.jsx)(s.code,{children:"User"})," to store common information like ",(0,n.jsx)(s.code,{children:"first_name"})," and ",(0,n.jsx)(s.code,{children:"last_name"}),". It then creates a specific ",(0,n.jsx)(s.code,{children:"Customer"})," or ",(0,n.jsx)(s.code,{children:"Provider"})," record for role-specific data. This is a flexible architecture that allows for different user types."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"OTP Generation & Mailing"}),": An OTP is generated, saved to the ",(0,n.jsx)(s.code,{children:"otp_verifications"})," table with an expiry time, and then immediately sent to the user's email address using a queued ",(0,n.jsx)(s.code,{children:"RegistrationOtp"})," Mailable. Using a queue (",(0,n.jsx)(s.code,{children:"->send()"}),") ensures that the user doesn't have to wait for the email to be sent before receiving a response from the API."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Media Handling (Spatie Media Library)"}),": The code checks if an ",(0,n.jsx)(s.code,{children:"avatar"})," (or other files for providers) is present in the request. If so, it uses the ",(0,n.jsx)(s.code,{children:"spatie/laravel-medialibrary"})," package to attach the uploaded file to the corresponding model (",(0,n.jsx)(s.code,{children:"Profile"})," for avatar, ",(0,n.jsx)(s.code,{children:"Provider"})," for documents) and assign it to a specific \"collection\" (e.g., 'avatar', 'commercial_file')."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"2-provider-registration",children:"2. Provider Registration"}),"\n",(0,n.jsx)(s.p,{children:"This endpoint allows a new user to register as a Provider (Individual or Establishment)."}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Endpoint:"})," ",(0,n.jsx)(s.code,{children:"POST /api/v1/register/provider"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Method:"})," ",(0,n.jsx)(s.code,{children:"POST"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Authentication:"})," Not required"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"request-body-1",children:"Request Body"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Parameter"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Rules"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"first_name"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Min 2, max 50 characters. Must contain only letters (Arabic/English) and spaces."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_name"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Min 2, max 50 characters. Must contain only letters (Arabic/English) and spaces."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"email"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be a valid email format and unique in the ",(0,n.jsx)(s.code,{children:"users"})," table."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contact_email"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be a valid email format and unique in the ",(0,n.jsx)(s.code,{children:"providers"})," table."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"password"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. Must be at least 8 characters and contain letters, mixed case, numbers, and symbols. Must be sent with a matching ",(0,n.jsx)(s.code,{children:"password_confirmation"})," field."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"phone"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Must be a unique phone number. Must contain only digits, between 8 and 15 digits long."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"phone_country"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Must be a valid country code."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"gender"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsx)(s.td,{children:"Required. Must be one of the allowed gender values."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"city_id"})}),(0,n.jsx)(s.td,{children:"integer"}),(0,n.jsx)(s.td,{children:"Required. Must be a valid city ID."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"nationality_id"})}),(0,n.jsx)(s.td,{children:"integer"}),(0,n.jsx)(s.td,{children:"Required. Must be a valid nationality ID."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"account_type"})}),(0,n.jsx)(s.td,{children:"string"}),(0,n.jsxs)(s.td,{children:["Required. The type of provider account (e.g., ",(0,n.jsx)(s.code,{children:"establishment"}),", ",(0,n.jsx)(s.code,{children:"individual"}),")."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"establishment_date"})}),(0,n.jsx)(s.td,{children:"date"}),(0,n.jsxs)(s.td,{children:["Required if ",(0,n.jsx)(s.code,{children:"account_type"})," is ",(0,n.jsx)(s.code,{children:"establishment"}),". A valid date."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"avatar"})}),(0,n.jsx)(s.td,{children:"file"}),(0,n.jsx)(s.td,{children:"Optional. Image file (png, jpg, jpeg) up to 2MB."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"authorization_form"})}),(0,n.jsx)(s.td,{children:"array of files"}),(0,n.jsxs)(s.td,{children:["Required if ",(0,n.jsx)(s.code,{children:"account_type"})," is ",(0,n.jsx)(s.code,{children:"establishment"}),". An array of files (jpg, jpeg, png, pdf), each up to 2MB."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"commercial_file"})}),(0,n.jsx)(s.td,{children:"array of files"}),(0,n.jsxs)(s.td,{children:["Required if ",(0,n.jsx)(s.code,{children:"account_type"})," is ",(0,n.jsx)(s.code,{children:"establishment"}),". An array of files (jpg, jpeg, png, pdf), each up to 2MB."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"tax_file"})}),(0,n.jsx)(s.td,{children:"array of files"}),(0,n.jsxs)(s.td,{children:["Required if ",(0,n.jsx)(s.code,{children:"account_type"})," is ",(0,n.jsx)(s.code,{children:"establishment"}),". An array of files (jpg, jpeg, png, pdf), each up to 2MB."]})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"success-response-1",children:"Success Response"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Code:"})," ",(0,n.jsx)(s.code,{children:"200 OK"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Content:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\r\n    "message": "Data created successfully.",\r\n    "data": {\r\n        "end_at": "2024-08-01T12:00:00.000000Z"\r\n    }\r\n}\n'})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"end_at"}),": The timestamp indicating when the OTP for account activation will expire."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"code-highlights--key-concepts-1",children:"Code Highlights & Key Concepts"}),"\n",(0,n.jsx)(s.p,{children:"This flow shares the same core concepts as Customer Registration (Transactions, Inactive User Creation, OTP, Media Handling). Key differences for Providers include:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Conditional Logic for Account Type"}),": The code checks the ",(0,n.jsx)(s.code,{children:"account_type"}),". If it is ",(0,n.jsx)(s.code,{children:"establishment"}),", it saves all establishment-related data, including ",(0,n.jsx)(s.code,{children:"establishment_date"})," and the various required files (",(0,n.jsx)(s.code,{children:"authorization_form"}),", ",(0,n.jsx)(s.code,{children:"commercial_file"}),", ",(0,n.jsx)(s.code,{children:"tax_file"}),"). If the type is ",(0,n.jsx)(s.code,{children:"individual"}),", this data is ignored."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Default Provider Level"}),": When a new Provider is created, they are automatically assigned a ",(0,n.jsx)(s.code,{children:"ProviderLevel"})," of 1. This ensures that every new provider starts at a default tier, which can later be upgraded."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Multiple File Collections"}),": For establishment providers, the system handles multiple file uploads. It iterates through each array of files (",(0,n.jsx)(s.code,{children:"authorization_form"}),", ",(0,n.jsx)(s.code,{children:"commercial_file"}),", etc.) and attaches them to the Provider's media library, each in its own distinct collection. This keeps the provider's documents organized and easy to retrieve."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453:(e,s,i)=>{i.d(s,{R:()=>d,x:()=>c});var r=i(6540);const n={},t=r.createContext(n);function d(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);